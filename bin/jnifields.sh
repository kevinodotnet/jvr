#!/bin/bash

rm fields.out 2>/dev/null
cat $1 | grep "INIT_CLASS" | grep -v "^#define" | cut -d',' -f1 | cut -d'(' -f2 | sed 's/$/;/' | sed 's/^/jclass /' >> fields.out
cat $1 | grep "INIT_METHOD" | grep -v "^#define" | cut -d',' -f2 | cut -d')' -f1 | sed 's/$/;/' | sed 's/^/jmethodID /' >> fields.out
cat $1 | grep "INIT_STATIC_METHOD" | grep -v "^#define" | cut -d',' -f2 | cut -d')' -f1 | sed 's/$/;/' | sed 's/^/jmethodID /' >> fields.out
cat $1 | grep "INIT_FIELD" | grep -v "^#define" | cut -d',' -f2 | sed 's/$/;/' | sed 's/^/jfieldID /' >> fields.out

(
echo "//"
echo "// This file is autogenerated from jnifields.cpp."
echo "// Run bin/jnifields.sh to rebuild it."
echo "// Any hand-made changes may be lost when you run 'make'"
echo "//"
echo ""
echo ""
echo "int initializeJNIFields (JNIEnv *e);"
echo ""
echo ""

echo "#ifdef JNIFIELDSCPP"
cat fields.out
echo "#else"
cat fields.out | sed 's/^/extern /'
echo "#endif"
) > $2
rm fields.out 2>/dev/null
